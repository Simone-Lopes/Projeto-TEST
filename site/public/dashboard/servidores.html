<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/LogoSemFundo.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST | Dashboards</title>

    <link rel="stylesheet" href="../css/servidores.css">
    <!-- <script src="../js/funcoes.js"></script> -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--FONT AWESOME-->
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>
</head>

<body>

    <!-- INICIANDO NAVBAR SUPERIOR -->
    <div class="nav-bar">
        <div class="container-nav-bar">
            <img src="../assets/icon/LogoSemFundo.png" alt="">

            <ul class="navbar">
                <li class="agora">
                    <a href="index.html">DASHBOARD</a>
                </li>
                <li>
                    <div class="">
                        <a href="../index.html">SAIR</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <div class="janela">

        <!-- INICIANDO NAV-BAR LATERAL -->
        <div class="header-left">

            <!-- DADOS DO USUÁRIO -->
            <div class="hello">
                <img src="../Imagens/icon_user.png" alt="">
                <div class="text-hello">
                    <h3><span id="b_usuario">usuário</span>!</h3>
                    <h4><span id="c_usuario">Nível de permissão</span></h4>
                </div>
            </div>

            <!-- SERVIDORES CADASTRADOS -->
            <div class="container-server">

                <!-- botão equipe -->
                <a href="./homeDashboard.html">
                    <div class="btn-nav">
                        <img class="img_icon" src="../Imagens/icon-casa-cinza.png" alt="">
                        <h3 style="margin-bottom: 11px;">Home</h3>
                    </div>
                </a>
                <br>

                <div class="btn-nav-server">
                    <img class="img_icon" src="../Imagens/icon-lupa-cinza.png" alt="">
                    <a href="./dashboard.html">
                        <h3>Monitorando</h3>
                    </a>
                </div>
                <br>

                <div class="btns-dash">
                    <!-- O gráfico é chamado de acordo com o id (fk_aquario) do banco  -->
                    <!-- <button class="btn-chart btn-server" onclick="exibirAquario(1)" id="btnAquario1">Servidor 1</button>
                    <button class="btn-chart btn-server" onclick="exibirAquario(2)" id="btnAquario2">Servidor 2</button>
                    <button class="btn-chart btn-server" onclick="exibirAquario(3)" id="btnAquario3">Servidor 3</button>
                    <button class="btn-chart btn-server" onclick="exibirAquario(4)" id="btnAquario4">Servidor 4</button> -->
                </div>
            </div>

            <!-- botão equipe -->
            <a href="./equipe.html">
                <div class="btn-nav">
                    <img class="img_icon" src="../Imagens/icon-equipe-cinza.png" alt="">
                    <h3>Equipe</h3>
                </div>
            </a>

            <!-- Botão servidores -->
            <a href="./servidores.html">
                <div class="btn-nav-current">
                    <img class="img_icon" src="../Imagens/icon-servidor-preto.png" alt="">

                    <h3>Servidores</h3>
                </div>
            </a>

            <!-- botão suporte -->
            <a href="#">
                <div class="btn-nav">
                    <img class="img_icon" src="../Imagens/icon-suporte-cinza.png" alt="">
                    <h3>Suporte</h3>
                </div>
            </a>

        </div>

        <!-- INICIANDO CADASRO DE EQUIPE -->

        <div class="dash">
            <!-- INICIANDO CARDS FORMULARIO -->

            <div class="alerta_erro">
                <div class="card_erro" id="cardErro">
                  <span id="mensagem_erro"></span>
                </div>
              </div>

            <div class="card-cadastro-servidor" id="cadastrarSer">


                <div class="card-form">
                    <!-- INICIANDO CAMPOS DO FORMULARIO -->
                    <div class="text-field">

                        <label class="label" for="ip">IP DO SERVIDOR</label><br>
                        <input type="text" id="input_ip_cadastro" placeholder=" Digite o endereço de IP do servidor"><br>

                        <label class="label" for="nome">SISTEMA OPERACIONAL</label><br>
                        <select id="input_so_cadastro">
                            <option value="" disabled selected>Selecione...</option>
                            <option value="Windows Server">Windows Server</option>
                            <option value="Ubuntu Server">Ubuntu Server</option>
                            <option value="Debian">Debian</option>
                            <option value="CentOS">CentOS</option>
                            <option value="Alpine Linux">Alpine Linux</option>
                            <option value="Red Hat Enterprise Linux">Red Hat Enterprise Linux (RHEL)</option>
                            <option value="Unix">Unix</option>
                            <option value="Mandriva">Mandriva</option>
                            <option value="Solaris">Solaris</option>
                            <option value="FreeBSD">FreeBSD</option>
                            <option value="VMware vSphere">VMware vSphere</option>
                            <option value="Mware ESXi">VMware ESXi</option>
                            <option value="AIX">AIX</option>
                            <option value="HP-UX">HP-UX</option>
                            <option value="Docker">Docker</option>

                        </select><br>

                        <label class="label" for="localização">LOCALIZAÇÃO </label><br>
                        <input type="text" id="input_localizacao_cadastro"
                            placeholder=" Digite uma breve localização (prédio, andar, sala...)"><br>

                    </div>


                    <div class="container-button">
                        <button onclick="cadastrarSv()" class="botao-login">CADASTRAR <span class="seta">→</span></button>
                    </div>
                </div>

                <div class="card-equipe">
                    <button class="btn-equipe" onclick="editarServidor()">
                        <h4>EDITAR SERVIDOR</h4>
                    </button>
                    <button class="btn-select" onclick="cadastrarServidor()">
                        <h2> ▷ CADASTRAR SERVIDOR</h2>
                    </button>
                    <button class="btn-equipe" onclick="excluirServidor()">
                        <h4>EXCLUIR SERVIDOR</h4>
                    </button>
                </div>
            </div>

            <div class="card-editar-servidor" id="editarSer">

                <div class="card-form">
                    <!-- INICIANDO CAMPOS DO FORMULARIO -->
                    <div class="text-field">

                        <label class="label" for="nome">IP DO SERVIDOR</label><br>
                        <input type="text" id="input_ip_novo" placeholder="Digite o IP do servidor"><br>

                        <!-- a -->
                        <label class="label" for="nome">NOVO SISTEMA OPERACIONAL</label><br>
                        <select id="input_so_novo">
                            <option value="" disabled selected>Selecione...</option>
                            <option value="Windows Server">Windows Server</option>
                            <option value="Ubuntu Server">Ubuntu Server</option>
                            <option value="Debian">Debian</option>
                            <option value="CentOS">CentOS</option>
                            <option value="Alpine Linux">Alpine Linux</option>
                            <option value="Red Hat Enterprise Linux">Red Hat Enterprise Linux (RHEL)</option>
                            <option value="Unix">Unix</option>
                            <option value="Mandriva">Mandriva</option>
                            <option value="Solaris">Solaris</option>
                            <option value="FreeBSD">FreeBSD</option>
                            <option value="VMware vSphere">VMware vSphere</option>
                            <option value="Mware ESXi">VMware ESXi</option>
                            <option value="AIX">AIX</option>
                            <option value="HP-UX">HP-UX</option>
                            <option value="Docker">Docker</option>

                        </select><br>

                        <label class="label" for="nome">NOVA LOCALIZAÇÃO</label><br>
                        <input type="text" id="input_localizacao_nova" placeholder=" Digite a nova localização"><br>

                    </div>


                    <div class="container-button">
                        <button onclick="atualizar_servidor()" class="botao-login">ATUALIZAR <span class="seta">→</span></button>
                    </div>
                </div>

                <div class="card-equipe">
                    <button class="btn-select" onclick="editarServidor()">
                        <h2> ▷ EDITAR SERVIDOR</h2>
                    </button>
                    <button class="btn-equipe" onclick="cadastrarServidor()">
                        <h4>CADASTRAR SERVIDOR</h4>
                    </button>
                    <button class="btn-equipe" onclick="excluirServidor()">
                        <h4>EXCLUIR SERVIDOR</h4>
                    </button>
                </div>
            </div>

            <div class="card-excluir-servidor" id="excluirSer">

                <div class="card-form">
                    <!-- INICIANDO CAMPOS DO FORMULARIO -->
                    <div class="text-field">

                        <label class="label" for="ip">IP DO SERVIDOR</label><br>
                        <input type="text" id="input_ip" placeholder="Digite o IP do servidor que será excluido"><br>

                    </div>


                    <div class="container-button">
                        <button onclick="excluir_servidor()" class="botao-login">EXCLUIR <span class="seta">→</span></button>
                    </div>
                </div>

                <div class="card-equipe">
                    <button class="btn-equipe" onclick="editarServidor()">
                        <h4>EDITAR SERVIDOR</h4>
                    </button>
                    <button class="btn-equipe" onclick="cadastrarServidor()">
                        <h4>CADASTRAR SERVIDOR</h4>
                    </button>
                    <button class="btn-select" onclick="excluirServidor()">
                        <h2> ▷ EXCLUIR SERVIDOR</h2>
                    </button>
                </div>
            </div>


        </div>
    </div>


</body>

</html>

<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    sessionStorage.FK_INSTITUICAO

    var nivel_acesso = sessionStorage.NIVEL_ACESSO;

    if (nivel_acesso = 3) {
        c_usuario.innerHTML = "Administrador"
    }
    else if (nivel_acesso = 2) {
        c_usuario.innerHTML = "Visualizador e Editor"
    }
    else if (nivel_acesso = 1) {
        c_usuario.innerHTML = "Visualizador"
    }

    function cadastrarServidor() {
        cadastrarSer.style.display = 'flex';
        editarSer.style.display = 'none';
        excluirSer.style.display = 'none';
    }

    function cadastrarSv() {
            var ip_cadastroVAR = input_ip_cadastro.value;
            var so_servidor_cadastroVAR = input_so_cadastro.value;
            var localizacao_cadastroVAR = input_localizacao_cadastro.value;
            var fk_instituicaoVAR = sessionStorage.FK_INSTITUICAO;


        if (ip_cadastroVAR == "" || so_servidor_cadastroVAR == "" || localizacao_cadastroVAR == "") {
            cardErro.style.display = "block"
            mensagem_erro.innerHTML = "Todos os campos são obrigatórios";
            setTimeout(function () {
                cardErro.style.display = "none";
                    }, 3000);
            
            return false;
        }
        // Enviando o valor da nova input
        fetch("/servidor/cadastrarSv/", {
            
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                ip_cadastroServer:ip_cadastroVAR,
                so_servidor_cadastroServer:so_servidor_cadastroVAR,
                localizacao_cadastroServer:localizacao_cadastroVAR,
                fk_instituicaoServer:fk_instituicaoVAR,
                 

            })
           
        }).then(function (resposta) {

            console.log("resposta: ", resposta);
            
            if (resposta.ok) {
                cardErro.style.display = "block";

                mensagem_erro.innerHTML = `Cadastro do servidor: ${ip_cadastroVAR} realizado`;
                cardErro.style.borderColor = "green";
                setTimeout(function () {
                location.reload()
                    }, 3000);

                limparFormulario();
                
            } else {
                cardErro.style.display = "block";

                mensagem_erro.innerHTML = `Não foi possível realizar o cadastro do servidor. <b>Servidor já existente</b>`;
                setTimeout(function () {
                location.reload()
                    }, 3000);
                finalizarAguardar();
                throw ("Houve um erro ao tentar realizar o cadastro do servidor!");
            }
        }).catch(function (resposta) {
            // FALTA COLOCAR A MENSAGEM DE ERRO INNERHTML
            console.log(`#ERRO: ${resposta}`);
        });
        return false;
    }
        

    function editarServidor() {
        cadastrarSer.style.display = 'none';
        editarSer.style.display = 'flex';
        excluirSer.style.display = 'none';
    }

    function atualizar_servidor() {
            var input_ip_novoVAR = input_ip_novo.value;
            var input_so_novoVAR = input_so_novo.value;
            var input_localizacao_novaVAR = input_localizacao_nova.value;

        if (input_ip_novoVAR == "" || input_so_novoVAR == "" || input_localizacao_novaVAR == "") {
            cardErro.style.display = "block"
            mensagem_erro.innerHTML = "Todos os campos são obrigatórios";
            setTimeout(function () {
                cardErro.style.display = "none";
                    }, 3000);
            
            return false;
        }
        // Enviando o valor da nova input
        fetch("/servidor/atualizar_servidor/", {
            
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                input_ip_novoServer:input_ip_novoVAR,
                input_so_novoServer:input_so_novoVAR,
                input_localizacao_novaServer:input_localizacao_novaVAR,

            })
           
        }).then(function (resposta) {

            console.log("resposta: ", resposta);
            
            if (resposta.ok) {
                cardErro.style.display = "block";

                mensagem_erro.innerHTML = `Atualização de servidor realizada com sucesso`;
                cardErro.style.borderColor = "green";
                setTimeout(function () {
                location.reload()
                    }, 3000);

                limparFormulario();
                
            } else {
                cardErro.style.display = "block";

                mensagem_erro.innerHTML = `Não foi possível atualizar o servidor`;
                setTimeout(function () {
                location.reload()
                    }, 3000);
                finalizarAguardar();
                throw ("Houve um erro ao tentar realizar a atualização do servidor!");
            }
        }).catch(function (resposta) {
            // FALTA COLOCAR A MENSAGEM DE ERRO INNERHTML
            console.log(`#ERRO: ${resposta}`);
        });
        return false;
    }

    function excluirServidor() {
        excluirSer.style.display = 'flex';
        cadastrarSer.style.display = 'none';
        editarSer.style.display = 'none';
    }

        function excluir_servidor() {
            var input_ipVAR = input_ip.value;
    
        if (input_ipVAR == "") {
            cardErro.style.display = "block"
            mensagem_erro.innerHTML = "O IP do servidor é necessário para <b>exclusão</b>";
            setTimeout(function () {
                cardErro.style.display = "none";
                    }, 3000);
            
            return false;
        }
        // Enviando o valor da nova input
        fetch("/servidor/excluir_servidor/", {
            
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                input_ipServer:input_ipVAR,
            })
           
        }).then(function (resposta) {

            console.log("resposta: ", resposta);
            
            if (resposta.ok) {
                cardErro.style.display = "block";

                mensagem_erro.innerHTML = `Exclusão do servidor <b>${input_ipVAR}</b> realizada com sucesso`;
                cardErro.style.borderColor = "green";
                setTimeout(function () {
                location.reload()
                    }, 3000);

                limparFormulario();
                
            } else {
                cardErro.style.display = "block";

                mensagem_erro.innerHTML = `Não foi possível excluir o servidor`;
                setTimeout(function () {
                location.reload()
                    }, 3000);
                finalizarAguardar();
                throw ("Houve um erro ao tentar realizar a exclusão do servidor!");
            }
        }).catch(function (resposta) {
            // FALTA COLOCAR A MENSAGEM DE ERRO INNERHTML
            console.log(`#ERRO: ${resposta}`);
        });
        return false;
    }

</script>